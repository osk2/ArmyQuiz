<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>國軍姿勢王</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<link rel="stylesheet" type="text/css" href="http://csshake.surge.sh/csshake.min.css">
	<link rel="stylesheet" href="css/animate.css">
	<link rel="stylesheet" href="css/style.css">
</head>
<body>
	<div class="container container-welcome">
		<div class="row">
			
		</div>
	</div>
	<div class="container container-quiz">
		<div class="row row-profile">
			<br>
			<div class="col-md-4 col-xs-3 col-xs-offset-1 profile-container">
				<div class="thumbnail">
					<img src="img/soldier.jpg" class="profile_image">
					<div class="caption">
						<h4>臭二兵</h4>
					</div>
				</div>
			</div>
			<div class="col-md-4 col-xs-6 col-xs-offset-2">
				<h1 class="current-score">0</h1>
			</div>
		</div>
		<div class="row row-quiz"></div>
		<p class="hidden-xs">&nbsp;</p>
		<p>&nbsp;</p>
	</div>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
	<script src="js/velocity.min.js"></script>
	<script src="js/jquery.animateNumber.min.js"></script>

	<script>
		$(function() {

			var questions;

			$.getJSON('questions.json', function(data) {
				questions = shuffle(data);
				load_question();
			});


			var shuffle = function(array) {
				let counter = array.length;
				while (counter > 0) {
					let index = Math.floor(Math.random() * counter);
					counter--;
					let temp = array[counter];
					array[counter] = array[index];
					array[index] = temp;
				}
				return array;
			}

			var bind_click_event = function() {

				$(document).one('click', '.btn-answer', function() {
					var that = $(this),
						score = $('.current-score'),
						current_score = parseInt(score.text());

					if (that.attr('data-correct') !== '1') {
						$('html').addClass('shake shake-constant');
						that.addClass('btn-danger').find('.glyphicon-remove').show();

						setTimeout(function() {
							$('html').removeClass('shake shake-constant')
						}, 200);

						navigator.vibrate(100);
						load_next_question(that);
					} else {
						score.prop('number', current_score).animateNumber({number: current_score + 200});
						that.addClass('btn-correct shake shake-constant').find('.glyphicon-ok').show();
						load_next_question(that);
					}
				});
			}

			var load_question = function() {

				if (questions.length <= 0 ){
					console.log('end');
					return;
				}

				var question = questions[0].question,
					answers = shuffle(questions[0].answers),
					answer_buttons = '';

				for (var i = 0; i < answers.length; i++) {
					var correct = answers[i].correct ? '1' : '0';
					answer_buttons +=  '<button class="btn btn-default btn-lg btn-block btn-answer row" data-correct="'+ correct +'" style="display: none">'+
											'<span class="col-md-11">'+ questions[0].answers[i].title +'</span>'+
										'</button>';
				}

				$('.row-quiz').html(
					'<div class="col-md-8 col-md-offset-2 col-xs-10 col-xs-offset-1 quiz-container">'+
						'<h2 class="quiz-text">'+ questions[0].question +'</h2>'+
						answer_buttons +
					'</div>'
				);

				$('.btn-answer').prepend(
					'<i class="glyphicon glyphicon-remove col-md-1" style="display: none"></i>'+
					'<i class="glyphicon glyphicon-ok col-md-1" style="display: none"></i>'
				);

				questions.splice(0, 1);

				$('.quiz-text').velocity('fadeIn', {duration: 1000});

				setTimeout(function() {
					$('.btn-answer').show().addClass('animated bounceIn').one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', function() {
						$(this).removeClass('animated bounceIn');
					});
				}, 1500);

				bind_click_event();
			}

			var load_next_question = function(that) {

				var correct_answer = $('.quiz-container .btn-answer[data-correct="1"]'),
					wrong_answer = $('.quiz-container .btn-answer[data-correct="0"]');

				setTimeout(function() {
					that.removeClass('shake shake-constant');
				}, 80);

				setTimeout(function() {
					correct_answer.addClass('btn-correct').find('.glyphicon-ok').show();
					wrong_answer.velocity({opacity: 0}, {visibility: 'hidden'});
				}, 1000);

				setTimeout(function() {
					correct_answer.velocity('fadeOut', {duration: 300});
				}, 2500);

				setTimeout(function() {
					load_question();
				}, 3200)
			}

		});

	</script>
</body>
</html>